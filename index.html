<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Melody's Mystery Elevator</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: white;
      text-align: center;
    }
    #introContainer, #videoNarrationContainer {
      display: none;
      height: 100vh;
      align-items: center;
      justify-content: center;
      padding: 40px;
    }
    #introContainer {
      display: flex;
    }
    #melodyImg {
      max-height: 80vh;
      max-width: 90%;
      border-radius: 20px;
    }
    #introText {
      font-size: 1.5em;
      line-height: 1.6;
      padding: 0 40px;
    }
    #continueButton {
      margin-top: 30px;
      padding: 14px 28px;
      font-size: 1em;
      border-radius: 10px;
      background-color: #4b2e83;
      color: white;
      border: none;
      cursor: pointer;
    }
    #videoNarrationContainer video {
      width: 80vw;
      max-width: 1000px;
      height: auto;
    }
  </style>
</head>
<body>

<div id="introContainer">
  <div>
    <img id="melodyImg" src="Melody.png" alt="Melody the cat">
  </div>
  <div>
    <div id="introText">
      Hi there! <br>
      My name is Melody, and I love music! <br>
      Every day, I ride an elevator to get to music class. <br>
      But today, something strange is happening...
    </div>
    <button id="continueButton" disabled>Continue</button>
  </div>
</div>

<div id="videoNarrationContainer">
  <video id="introVideo" src="intro_video.mp4" playsinline></video>
  <audio id="introNarration2" src="intro_narration2.mp3"></audio>
</div>

<script>
  let participantID = null;

  window.onload = async () => {
    while (!participantID) {
      participantID = prompt("Enter your Participant ID:");
      if (participantID) participantID = participantID.trim();
    }

    // Show the intro screen
    document.getElementById('introContainer').style.display = 'flex';

    const narration = new Audio("intro_narration.mp3");
    narration.play();
    narration.onended = () => {
      document.getElementById("continueButton").disabled = false;
    };

    document.getElementById("continueButton").addEventListener("click", () => {
      // Hide intro and show video+audio
      document.getElementById("introContainer").style.display = "none";
      document.getElementById("videoNarrationContainer").style.display = "flex";

      const video = document.getElementById("introVideo");
      const audio = document.getElementById("introNarration2");

      video.play();
      audio.play();

      // Wait until both finish, then go to practice (youâ€™ll fill in)
      const onEnded = () => {
        video.removeEventListener("ended", onEnded);
        audio.removeEventListener("ended", onEnded);
        document.getElementById("videoNarrationContainer").style.display = "none";

        // Call practice block setup (you'll define this)
        alert("Now the practice trials will begin!");
        // runPracticeTrials("tempo"); <-- you'll uncomment this when defined
      };

      video.addEventListener("ended", onEnded);
      audio.addEventListener("ended", onEnded);
    });
  };
</script>

</body>
</html>
