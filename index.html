<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Melody's Mystery Elevator</title>
  <style>
    body { margin:0; background:white; font-family:Arial; text-align:center; }
    #visual-container { width:90vw; height:80vh; max-width:1400px; max-height:950px;
      margin:80px auto 0; position:relative; overflow:hidden; background:white;
      display:flex; align-items:center; justify-content:center; }
    #screen { position:absolute; inset:0; display:flex; flex-direction:column;
      align-items:center; justify-content:center; padding:40px; box-sizing:border-box; }
    .media-content { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%);
      max-width:100%; max-height:100%; object-fit:contain; display:none; }
    .btn-primary { padding:12px 24px; font-size:1.2em; border:none; border-radius:8px;
      background:linear-gradient(135deg,#f3e7ff,#d0b3ff); color:#4b2e83;
      cursor:pointer; transition:transform .2s; }
    .btn-primary:hover { transform:scale(1.05); }
    .tempo-btn, .elevator-option { cursor:pointer; margin:0 8px; }
  </style>
</head>
<body>
  <div id="visual-container">
    <div id="screen"></div>
    <img id="stillframe1" class="media-content" src="stillframe1.png">
    <img id="gapStillframe" class="media-content" src="gapStillframe.png">
    <img id="stillframe2" class="media-content" src="stillframe2.png">
    <video id="video1" class="media-content" playsinline preload="auto" muted src="video1.mp4"></video>
    <video id="gapVideo" class="media-content" playsinline preload="auto" muted src="gapVideo.mp4"></video>
    <video id="video2" class="media-content" playsinline preload="auto" muted src="video2.mp4"></video>
  </div>
  <div id="trialControls"></div>
  <audio id="myAudio" hidden preload="auto"></audio>
  <script>
    // helper
    function updateScreen(html, bg='transparent'){ const s=document.getElementById('screen'); s.innerHTML=html; s.style.background=bg; }
    function hideMedia(){ document.querySelectorAll('.media-content').forEach(e=>{ e.style.display='none'; if(e.tagName==='VIDEO'){ e.pause(); e.currentTime=0; }}); }

    // global state
    let participantID, sessionID;
    let currentBlock=0, currentTrial=1;
    window.onload = ()=>{ getID(); };
    function getID(){
      participantID = prompt('Participant ID:');
      if(!participantID) return getID();
      sessionID = participantID + '_' + new Date().toISOString();
      showIntro();
    }

    // 1. INTRO
    function showIntro(){
      updateScreen(`
        <h1>Melody's Mystery Elevator</h1>
        <p>Welcome! Click to begin.</p>
        <button id="btn1" class="btn-primary">Continue</button>
      `);
      document.getElementById('btn1').onclick = showInstructions1;
    }
    // 2. INSTR BEFORE DEMO
    function showInstructions1(){
      updateScreen(`
        <p>Let's learn about tempo changes.</p>
        <button id="btn2" class="btn-primary">Start Demo</button>
      `);
      document.getElementById('btn2').onclick = tempoDemoNoResponse;
    }

    // 3. TEMPO DEMO NO RESPONSE
    function tempoDemoNoResponse(){
      // fast demo
      updateScreen(`<video id="d1" style="max-width:100%;max-height:100%;object-fit:contain;">
        <source src="PT_FAST1.mp4" type="video/mp4"></video>`);
      const v1=document.getElementById('d1'); v1.onended = ()=>{
        // slow demo
        updateScreen(`<video id="d2" style="max-width:100%;max-height:100%;object-fit:contain;">
          <source src="PT_SLOW1.mp4" type="video/mp4"></video>`);
        const v2=document.getElementById('d2'); v2.onended = showInstructions2;
        v2.play();
      };
      v1.play();
    }
    // 4. INSTR BEFORE PRACTICE RESP
    function showInstructions2(){
      updateScreen(`
        <p>Now practice: faster, slower, or same?</p>
        <button id="btn3" class="btn-primary">Begin Practice</button>
      `);
      document.getElementById('btn3').onclick = tempoPracticeWithResponse;
    }

    // 5. TEMPO PRACTICE WITH RESPONSE
    function tempoPracticeWithResponse(){
      const trials = [
        {file:'PT_FAST2.mp4',correct:'fast'},
        {file:'PT_SLOW2.mp4',correct:'slow'}
      ]; let idx=0;
      function next(){
        if(idx>=trials.length) return showInstructions3();
        const t=trials[idx++];
        updateScreen(`<video id="p" style="max-width:100%;max-height:100%;object-fit:contain;"><source src="${t.file}" type="video/mp4"></video>`);
        const vp=document.getElementById('p'); vp.onended=()=>showResponse(t.correct,next);
        vp.play();
      }
      next();
    }
    function showResponse(correct,cb){
      updateScreen(`
        <h2>How did it sound?</h2>
        <button data-choice="fast" class="tempo-btn btn-primary">Fast</button>
        <button data-choice="slow" class="tempo-btn btn-primary">Slow</button>
        <button data-choice="same" class="tempo-btn btn-primary">Same</button>
        <div id="fb"></div>
      `);
      document.querySelectorAll('.tempo-btn').forEach(b=>b.onclick=()=>{
        const c=b.getAttribute('data-choice'); const fb=document.getElementById('fb');
        if(c===correct){ fb.innerHTML='<p style="color:green;">Correct!</p>'; setTimeout(cb,800); }
        else fb.innerHTML='<p style="color:red;">Try again.</p>';
      });
    }
    // 6. INSTR BEFORE REAL TEMPO
    function showInstructions3(){
      updateScreen(`
        <p>Great! Now real tempo trials.</p>
        <button id="btn4" class="btn-primary">Start Real Tempo</button>
      `);
      document.getElementById('btn4').onclick = startRealTempo;
    }
    // 7. REAL TEMPO
    function startRealTempo(){
      updateScreen('<h2>Tempo Block: Trial 1 of ' + TRIALS_PER_BLOCK + '</h2>');
      // call your playTrial() logic here
    }
    // 8. INSTR BEFORE PITCH DEMO
    function showInstructionsPitch1(){
      updateScreen(`
        <p>Next up: pitch demo.</p>
        <button id="btn5" class="btn-primary">Start Pitch Demo</button>
      `);
      document.getElementById('btn5').onclick = pitchDemoNoResponse;
    }
    // 9. PITCH DEMO NO RESPONSE
    function pitchDemoNoResponse(){
      // high demo
      updateScreen(`<video id="h1" style="max-width:100%;max-height:100%;object-fit:contain;"><source src="PT_HIGH1.mp4" type="video/mp4"></video>`);
      const h=document.getElementById('h1'); h.onended=()=>{
        // low demo
        updateScreen(`<video id="l1" style="max-width:100%;max-height:100%;object-fit:contain;"><source src="PT_LOW1.mp4" type="video/mp4"></video>`);
        const l=document.getElementById('l1'); l.onended=showInstructionsPitch2;
        l.play();
      };
      h.play();
    }
    // 10. INSTR BEFORE PITCH PRACTICE RESP
    function showInstructionsPitch2(){
      updateScreen(`
        <p>Practice pitch: high, low, or same?</p>
        <button id="btn6" class="btn-primary">Begin Pitch Practice</button>
      `);
      document.getElementById('btn6').onclick = pitchPracticeWithResponse;
    }
    // 11. PITCH PRACTICE WITH RESPONSE
    function pitchPracticeWithResponse(){
      const trials=[{file:'PT_HIGH2.mp4',correct:'fast'},{file:'PT_LOW2.mp4',correct:'slow'}]; let idx=0;
      function next(){
        if(idx>=trials.length) return showInstructionsPitch3();
        const t=trials[idx++];
        updateScreen(`<video id="p2" style="max-width:100%;max-height:100%;object-fit:contain;"><source src="${t.file}" type="video/mp4"></video>`);
        const vp2=document.getElementById('p2'); vp2.onended=()=>showResponse(t.correct,next);
        vp2.play();
      }
      next();
    }
    // 12. INSTR BEFORE REAL PITCH
    function showInstructionsPitch3(){
      updateScreen(`
        <p>Now real pitch trials.</p>
        <button id="btn7" class="btn-primary">Start Real Pitch</button>
      `);
      document.getElementById('btn7').onclick = startRealPitch;
    }
    // 13. REAL PITCH
    function startRealPitch(){ updateScreen('<h2>Pitch Block: Trial 1 of ' + TRIALS_PER_BLOCK + '</h2>'); }
    // 14. END
    function showEnd(){ updateScreen('<h1>Thank you for participating!</h1>'); }
  </script>
</body>
</html>



