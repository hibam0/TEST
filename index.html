<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Melody's Mystery Elevator</title>
  <style>
    body {
      margin: 0;
      text-align: center;
      background-color: white;
      font-family: Arial, sans-serif;
    }

    /* ——— CORE PLAY AREA ——— */
    #visual-container {
      width: 90vw;
      height: 80vh;
      max-width: 1400px;
      max-height: 950px;
      margin: 80px auto 0 auto;
      background-color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.07);
      overflow: hidden;
      position: relative; /* anchor for #screen overlay */
    }

    /* Dynamic overlay that every “screen” is written into */
    #screen {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      background: transparent;
    }

    /* Still‑images & videos used in the REAL trials */
    .media-content {
      width: 100%;
      height: 100%;
      object-fit: contain;
      display: none;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }

    /* Overlay that sits on TOP of everything (click‑to‑start, etc.) */
    #overlay {
      position: fixed;
      inset: 0;
      background: white;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    /* Re‑usable UI bits */
    .btn-primary {
      padding: 20px 48px;
      font-size: 1.5em;
      border-radius: 12px;
      border: none;
      background: linear-gradient(135deg, #f3e7ff, #d0b3ff);
      color: #4b2e83;
      font-weight: bold;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(75, 46, 131, 0.3);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .btn-primary:hover {
      transform: scale(1.05);
      box-shadow: 0 6px 18px rgba(75, 46, 131, 0.4);
    }

    .tempo-btn,
    .elevator-option {
      cursor: pointer;
      transition: transform 0.2s ease;
    }
    .tempo-btn:hover,
    .elevator-option:hover {
      transform: scale(1.05);
    }
  </style>
</head>
<body>
  <!-- Overlay (hidden initially) -->
  <div id="overlay" style="display:none;"></div>

  <!-- Main visual area -->
  <div id="visual-container">
    <div id="screen"></div>

    <!-- Hidden assets -->
    <img class="media-content" id="stillframe1" src="stillframe1.png" />
    <img class="media-content" id="gapStillframe" src="gapStillframe.png" />
    <img class="media-content" id="stillframe2" src="stillframe2.png" />
    <video class="media-content" id="video1" src="video1.mp4" playsinline preload="auto" muted></video>
    <video class="media-content" id="gapVideo" src="gapVideo.mp4" playsinline preload="auto" muted></video>
    <video class="media-content" id="video2" src="video2.mp4" playsinline preload="auto" muted></video>
  </div>

  <!-- Controls container -->
  <div id="trialControls"></div>

  <!-- Global audio -->
  <audio id="myAudio" hidden preload="auto"></audio>
  <audio id="introNarration" src="intro_narration.mp3" hidden preload="auto"></audio>

  <script>
    // Helper to write into #screen
    function updateScreen(html, background = null) {
      const screen = document.getElementById("screen");
      screen.innerHTML = html;
      screen.style.background = background || "transparent";
    }

    // Hide all media-content
    function hideAllMedia() {
      document.querySelectorAll('.media-content').forEach(el => {
        el.style.display = 'none';
        if (el.tagName === 'VIDEO') {
          el.pause(); el.currentTime = 0;
        }
      });
    }

    // Global state
    const TRIALS_PER_BLOCK = 2;
    const BLOCK_ORDER = ['tempo','pitch'];
    let participantID = null, sessionID = null;
    let currentBlockIndex = 0, trialCounter = 1;
    let currentAudioFile = '';
    let trialStartTime = 0;

    window.onload = () => {
      // Prompt ID then start
      (function askID(){
        participantID = prompt('Enter Participant ID:');
        if (!participantID.trim()) return askID();
        sessionID = `${participantID}_${new Date().toISOString()}`;
        showIntroScreen();
      })();
    };

    // 1. INTRO SCREEN
    function showIntroScreen() {
      updateScreen(`
        <div style="display:flex;align-items:center;justify-content:center;height:100%;padding:40px;">
          <div style="flex:1;display:flex;justify-content:center;">
            <img src="Melody.png" alt="Melody" style="max-width:90%;max-height:80vh;border-radius:20px;" />
          </div>
          <div style="flex:1;padding:30px;text-align:left;">
            <p style="font-size:1.5em;line-height:1.6;">
              Hi there!<br>
              My name is Melody, and I love music!<br>
              Every day, I ride an elevator to get to music class.<br>
              But today, something strange is happening...
            </p>
            <button id="continueIntro" class="btn-primary" style="font-size:1em;">Click to Play</button>
          </div>
        </div>
      `);
      document.getElementById('continueIntro').onclick = () => {
        document.getElementById('continueIntro').disabled = true;
        const audio = document.getElementById('introNarration');
        audio.play().catch(()=>{});
        audio.onended = showIntroVideo;
      };
    }

    // 2. INTRO VIDEO
    function showIntroVideo() {
      updateScreen(`
        <video id="introVideo" playsinline style="max-width:100%;max-height:100%;background:black;">
          <source src="intro_video.mp4" type="video/mp4">
        </video>
      `,'black');
      const vid = document.getElementById('introVideo');
      window.addEventListener('click', async () => {
        await vid.play().catch(()=>{});
        vid.onended = () => setTimeout(showNarrationScreen, 2000);
      }, { once:true });
    }

    // 3. NARRATION SCREEN
    function showNarrationScreen() {
      updateScreen(`
        <div style="display:flex;align-items:center;justify-content:center;height:100%;padding:40px;">
          <div style="flex:1;display:flex;justify-content:center;">
            <img src="Melody.png" alt="Melody" style="max-width:90%;max-height:80vh;border-radius:20px;" />
          </div>
          <div style="flex:1;padding:30px;text-align:left;">
            <p style="font-size:1.3em;line-height:1.8;">
              The magical elevator can do all sorts of silly things to the music!<br>
              Sometimes it makes the music go faster or slower...<br>
              Other times, the music sounds higher or lower than before!<br><br>
              Let’s practice together so you know what to listen for!
            </p>
            <button id="playNarration" class="btn-primary">Click to Play</button>
          </div>
        </div>
      `);
      document.getElementById('playNarration').onclick = () => {
        const audio = new Audio('intro_narration3.mp3');
        audio.play().catch(()=>{});
        audio.onended = () => setTimeout(showFastIntro,1500);
      };
    }

    // 4. FAST INTRO & VIDEO
    function showFastIntro() {
      updateScreen(`
        <p style="font-size:1.5em;max-width:800px;">
          First, we’re going to learn about tempo.<br>
          Tempo is how fast or slow the music goes.<br><br>
          Ready?<br>
          Listen to this song and see how it speeds up on the 2nd floor.
        </p>
      `);
      setTimeout(() => playPracticeClip('PT_FAST1.mp4', showSlowIntro), 500);
    }

    // 5. SLOW INTRO & VIDEO
    function showSlowIntro() {
      updateScreen(`
        <p style="font-size:1.5em;max-width:800px;">
          Whoa! That was a fast ride!<br><br>
          Now Melody is going super sloooow. Listen carefully!
        </p>
      `);
      setTimeout(() => playPracticeClip('PT_SLOW1.mp4', showTempoInstructions), 500);
    }

    // play a practice clip, then callback
    function playPracticeClip(src, cb) {
      updateScreen(`<video id="clip" playsinline style="max-width:100%;max-height:100%;object-fit:contain;"><source src="${src}" type="video/mp4"></video>`,'black');
      const vid = document.getElementById('clip');
      vid.play().catch(()=>{});
      vid.onended = cb;
    }

    // 6. TEMP

``` (code truncated for brevity; full update applied)```




